cli_name="<%= cli_name %>"
release_name="<%= cli_release_name %>"

darwin_amd64_filename="<%= darwin_amd64_asset["name"] %>"
darwin_amd64_url="<%= darwin_amd64_asset["url"] %>"

lunix_amd64_filename="<%= linux_amd64_asset["name"] %>"
lunix_amd64_url="<%= linux_amd64_asset["url"] %>"

tmp_unarchive_path=${TMPDIR:-/tmp}

# $ man uname
# -a      Behave as though all of the options -mnrsv were specified.
# -m      print the machine hardware name.
# -s      print the operating system name.
os_name=$(uname -s)
os_hardware=$(uname -m)

#         $os_name $os_hardware
# OS X -  Darwin   x86_64
# Linux - Linux    x86_64

if [[ $os_hardware != "x86_64" ]]; then
  echo "Sorry, currently only 64-bit versions of $cli_name are being released"
  exit 1
fi

if [[ $os_name == "Darwin" ]]; then
  export download_url=$darwin_amd64_url
  export filename=$tmp_unarchive_path/$darwin_amd64_filename
elif [[ $os_name == "Linux" ]]; then
  export download_url=$linux_amd64_url
  export filename=$tmp_unarchive_path/$linux_amd64_filename
else
  echo "Sorry, currently only OS X & Linux versions of $cli_name are being released"
  echo "Please create a ticket to request $os_name $os_hardware releases to be cut; or build the CLI from source"
  echo "Create ticket at https://github.com/cloudfoundry/cli/issues/new"
  exit
fi

current_path=$(pwd)
cd $tmp_unarchive_path

if [[ "$(which curl)X" != "X" ]]; then
  echo "Downloading '$release_name' via curl..."
  curl -s -L -H "Accept: application/octet-stream" $download_url -o $filename
fi

cd $current_path
if [[ -f $filename ]]; then
  if [[ $filename =~ "tgz" ]]; then
    tar xf $filename
  elif [[ $filename =~ "zip" ]]; then
    unzip $filename
  else
    echo "Oops, I do not know how to unpackage $filename."
    echo "Please create a ticket at https://github.com/cloudfoundry-community/fetch_cf_cli/issues/new"
  fi
fi

echo "Now run the following to use Cloud Foundry CLI:"
echo "./$cli_name"
